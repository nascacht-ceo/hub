name: CD Tag Release
on:
  push:
    tags: [ 'v*' ]

jobs:
  release-pipeline:
    runs-on: ubuntu-latest
    environment: production  # Requires manual approval in GitHub UI
    permissions:
      contents: read
      id-token: write
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup & Restore
        uses: ./.github/actions/setup
        
      - name: Build Release
        uses: ./.github/actions/build
        with:
          configuration: Release

      - name: Pack Stable
        uses: ./.github/actions/pack
        with:
          configuration: Release
          # version_suffix omitted = Stable 1.0.0
          nuget_user: ${{ vars.NUGET_USER }}